# ========================================
# JAiRouter 主配置文件（简化版）
# ========================================
# 此文件为简化后的主配置文件，通过导入模块化配置实现功能分离
# 详细配置请参考各个模块配置文件

spring:
  main:
    allow-circular-references: true
  config:
    import:
      # 基础配置模块
      - classpath:config/base/server-base.yml
      - classpath:config/base/model-services-base.yml
      - classpath:config/base/monitoring-base.yml

      # 追踪配置模块
      - classpath:config/tracing/tracing-base.yml
      
      # 安全配置模块
      - classpath:config/security/security-base.yml
      - classpath:config/security/persistence-base.yml
      - classpath:config/security/audit-base.yml
      
      # 监控配置模块
      - classpath:config/monitoring/slow-query-alerts.yml
      - classpath:config/monitoring/error-tracking.yml
      - classpath:config/monitoring/persistence-monitoring-base.yml
      
  profiles:
    active: dev  # 默认使用开发环境
  
  # H2 数据库配置（默认配置）
  r2dbc:
    url: r2dbc:h2:file///./data/jairouter?DB_CLOSE_DELAY=-1;MODE=MySQL;DATABASE_TO_UPPER=FALSE
    username: sa
    password:
  
  # H2 控制台（默认关闭，开发环境可启用）
  h2:
    console:
      enabled: false

# ========================================
# 存储配置（默认使用 H2）
# ========================================
store:
  type: h2  # 存储类型：file, memory, h2
  migration:
    enabled: true  # 是否启用配置迁移
  security-migration:
    enabled: true  # 是否启用安全数据迁移

# ========================================
# 配置模块说明
# ========================================
# 原配置文件已按功能拆分到以下模块：
#
# 基础配置模块:
# - config/base/server-base.yml         # 服务器基础配置
# - config/base/model-services-base.yml # 模型服务配置  
# - config/base/monitoring-base.yml     # 监控基础配置
#
# 功能配置模块:
# - config/security/security-base.yml   # 安全功能配置
# - config/tracing/tracing-base.yml     # 追踪功能配置
# - config/monitoring/slow-query-alerts.yml # 慢查询告警配置
# - config/monitoring/error-tracking.yml    # 错误追踪配置
#
# 环境配置文件:
# - application-dev.yml                 # 开发环境覆盖配置
# - application-staging.yml             # 预发布环境覆盖配置
# - application-prod.yml                # 生产环境覆盖配置
# - application-legacy.yml              # 向后兼容配置
# - application-security-example.yml    # 安全配置示例

# ========================================
# 配置优先级说明
# ========================================
# 配置加载优先级（高优先级覆盖低优先级）：
# 1. 基础配置模块（最低优先级）
# 2. 功能配置模块
# 3. 环境特定配置文件  
# 4. 环境变量
# 5. 命令行参数（最高优先级）

# ========================================
# 使用说明
# ========================================
# 1. 基础配置修改：编辑 config/base/ 目录下的对应文件
# 2. 功能启用/禁用：编辑对应的功能配置文件
# 3. 环境差异配置：编辑对应的环境配置文件
# 4. 敏感配置：建议使用环境变量注入
#
# 示例：
# 启动开发环境：java -jar app.jar --spring.profiles.active=dev
# 启动生产环境：java -jar app.jar --spring.profiles.active=prod
# 启动兼容模式：java -jar app.jar --spring.profiles.active=legacy